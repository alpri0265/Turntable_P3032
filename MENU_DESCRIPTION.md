# Опис меню системи Turntable

## Загальна структура

Система має **багаторівневе меню** з навігацією через інкрементальний енкодер та встановленням цільового кута через абсолютний енкодер.

---

## Логіка роботи

### Інкрементальний енкодер (ENC_A/ENC_B)
- **Призначення:** навігація по меню
- **Функції:**
  - Обертання вгору/вниз → переміщення по пунктах меню
  - Натискання кнопки → вибір пункту або підтвердження дії

### Абсолютний енкодер P3022-CW360
- **Призначення:** встановлення цільового кута
- **Функції:**
  - Обертання енкодера → встановлення цільового кута (0-360°)
  - Система автоматично перевіряє, чи поточна позиція відповідає цільовій
  - Відображається в меню "Status"

---

## Структура меню

### 1. Головне меню (MENU_MAIN)

**LCD1602:**
```
┌────────────────┐
│ >Status        │  ← Вибраний пункт
│  Settings      │
└────────────────┘
```

**LCD2004:**
```
┌────────────────────┐
│ Main Menu          │
│ >Status            │  ← Вибраний пункт
│  Settings          │
│  Save Position     │
└────────────────────┘
```

**Пункти меню:**
1. **Status** - статус системи (поточний та цільовий кут)
2. **Settings** - налаштування (зарезервовано)
3. **Save Position** - збереження поточної позиції

**Навігація:**
- Обертання інкрементального енкодера → переміщення між пунктами
- Натискання кнопки → вхід у вибраний пункт

---

### 2. Меню статусу (MENU_STATUS)

Відображає поточний стан системи та перевіряє відповідність позиції.

**LCD1602:**
```
┌────────────────┐
│ Cur:  45°      │  ← Поточний кут
│ Tgt: 180°  ->  │  ← Цільовий кут (-> = рух, OK = досягнуто)
└────────────────┘
```

**LCD2004:**
```
┌────────────────────┐
│ Status              │
│ Current:  45°      │  ← Поточний кут столу
│ Target:  180°      │  ← Цільовий кут з абсолютного енкодера
│ Position: Moving   │  ← Статус: "Moving" або "OK"
└────────────────────┘
```

**Індикація:**
- **"Position: Moving"** - стіл рухається до цільової позиції
- **"Position: OK"** - поточна позиція відповідає цільовій (різниця < 2 кроків)

**Навігація:**
- Натискання кнопки → повернення до головного меню

**Особливості:**
- Цільовий кут встановлюється абсолютним енкодером P3022-CW360
- Система автоматично перевіряє відповідність позиції
- Оновлюється в реальному часі

---

### 3. Меню налаштувань (MENU_SETTINGS)

**LCD1602:**
```
┌────────────────┐
│ Settings       │
│ Press to return│
└────────────────┘
```

**LCD2004:**
```
┌────────────────────┐
│ Settings            │
│ (Not implemented)  │
│ Press button to    │
│ return             │
└────────────────────┘
```

**Навігація:**
- Натискання кнопки → повернення до головного меню

**Примітка:** Зарезервовано для майбутніх налаштувань

---

### 4. Меню збереження (MENU_SAVE)

**LCD1602:**
```
┌────────────────┐
│ Save Position  │
│ Press to confirm│
└────────────────┘
```

**LCD2004:**
```
┌────────────────────┐
│ Save Position       │
│ Current position    │
│ will be saved       │
│ Press to confirm    │
└────────────────────┘
```

**Навігація:**
- Натискання кнопки → збереження позиції в EEPROM
- Після збереження → повернення до головного меню
- Відображається повідомлення "Position saved to EEPROM"

---

## Послідовність роботи

### Приклад 1: Перевірка статусу

1. **Головне меню:**
   - Обертаємо інкрементальний енкодер до "Status"
   - Натискаємо кнопку

2. **Меню статусу:**
   - Бачимо поточний кут: `Cur: 45°`
   - Бачимо цільовий кут: `Tgt: 180°` (встановлений абсолютним енкодером)
   - Бачимо статус: `Position: Moving` або `Position: OK`

3. **Повернення:**
   - Натискаємо кнопку → повертаємося до головного меню

### Приклад 2: Встановлення цільового кута

1. **Встановлення кута:**
   - Обертаємо абсолютний енкодер P3022-CW360 до потрібного кута (наприклад, 90°)
   - Цільовий кут автоматично встановлюється

2. **Перевірка:**
   - Входимо в меню "Status"
   - Бачимо: `Target: 90°`
   - Система автоматично починає рух до цільової позиції

3. **Досягнення позиції:**
   - Коли позиція досягнута, статус змінюється на `Position: OK`

### Приклад 3: Збереження позиції

1. **Встановлення позиції:**
   - Встановлюємо потрібний кут абсолютним енкодером
   - Чекаємо досягнення позиції (`Position: OK`)

2. **Збереження:**
   - Переходимо в головне меню
   - Вибираємо "Save Position"
   - Натискаємо кнопку для підтвердження

3. **Підтвердження:**
   - Відображається повідомлення "Position saved to EEPROM"
   - Позиція збережена для наступного запуску

---

## Технічні деталі

### Перевірка відповідності позиції

Система вважає позицію досягнутою, якщо:
```
|effectivePosition - targetPosition| < 2 кроків
```

де `effectivePosition = currentPosition + remainingSteps`

### Оновлення екрану

- **Інтервал:** 100 мс (LCD_UPDATE_MS)
- **Неблокуюче:** не впливає на роботу крокового двигуна
- **Оптимізація:** оновлюється тільки при зміні стану

### Обмеження

- **Мінімальна позиція:** 0 кроків (0°)
- **Максимальна позиція:** 3200 кроків (360°)
- **Точність перевірки:** ±2 кроки

---

## Відображення на різних екранах

### LCD1602 - Компактний режим
- Показує 2 пункти одночасно
- Компактне відображення статусу
- Мінімальний простір

### LCD2004 - Розширений режим
- Показує всі пункти меню
- Детальна інформація про статус
- Додаткові повідомлення

---

## Особливості реалізації

### Неблокуюча робота
- Всі операції виконуються без затримок
- Меню оновлюється паралельно з рухом двигуна
- Енкодери обробляються в реальному часі

### Автоматична синхронізація
- Абсолютний енкодер автоматично встановлює цільовий кут
- Система автоматично перевіряє відповідність позиції
- Відображення оновлюється в реальному часі

### Оптимізація відображення
- Оновлюється тільки змінений контент
- Використовується кешування останніх значень
- Мінімальне навантаження на мікроконтролер

---

## Майбутні можливості (для розширення)

- Додаткові пункти в меню Settings
- Налаштування швидкості обертання
- Калібрування енкодерів
- Збереження кількох позицій
- Програми автоматичного обертання
- Статистика роботи
