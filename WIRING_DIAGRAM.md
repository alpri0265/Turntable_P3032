# Розпіновка підключення проекту Turntable

## Компоненти системи

1. **Arduino Mega 2560** - основна плата управління
2. **LCD 2004 I2C** - дисплей 20x4 символи з I2C модулем
3. **Енкодер KY-040** - для навігації по меню (з кнопкою)
4. **Абсолютний енкодер P3022-CW360** - для встановлення цільового кута
5. **Перемикач напрямку** - для вибору напрямку руху (CW/CCW)
6. **Кнопка старт-стоп** - запуск/зупинка двигуна
7. **Світлодіод** - індикація стану (рух/зупинка)
8. **Драйвер DM556D** - драйвер крокового двигуна
9. **Кроковий двигун** - підключений до драйвера

---

## Детальна розпіновка

### Arduino Mega 2560

#### Цифрові піни

| Пін Arduino | Компонент | Опис |
|-------------|-----------|------|
| **2** | KY-040 (CLK) | Енкодер KY-040 - пін A (INT0) |
| **3** | KY-040 (DT) | Енкодер KY-040 - пін B (INT1) |
| **4** | KY-040 (SW) | Енкодер KY-040 - кнопка |
| **5** | Тумблер | Тумблер перемикання напрямку (CW/CCW) |
| **6** | DM556D (STEP) | Драйвер DM556D - сигнал STEP |
| **7** | DM556D (DIR) | Драйвер DM556D - сигнал DIR |
| **22** | Кнопка старт-стоп | Кнопка запуску/зупинки |
| **23** | Світлодіод | Індикатор стану (рух/зупинка) |

#### Аналогові піни

| Пін Arduino | Компонент | Опис |
|-------------|-----------|------|
| **A0** | P3022-CW360 | Абсолютний енкодер (аналоговий вихід) |

#### I2C піни (для LCD 2004 I2C)

| Пін Arduino | Компонент | Опис |
|-------------|-----------|------|
| **20 (SDA)** | LCD 2004 I2C | I2C Data Line |
| **21 (SCL)** | LCD 2004 I2C | I2C Clock Line |

#### Живлення

| Пін Arduino | Компонент | Опис |
|-------------|-----------|------|
| **5V** | Різні компоненти | Живлення 5V |
| **GND** | Всі компоненти | Загальна земля |

---

## Підключення компонентів

### 1. LCD 2004 I2C

```
LCD 2004 I2C модуль:
├── VCC  → Arduino 5V
├── GND  → Arduino GND
├── SDA  → Arduino Pin 20 (SDA)
└── SCL  → Arduino Pin 21 (SCL)
```

**Примітка:** Адреса I2C за замовчуванням: **0x27** (може бути 0x3F)

---

### 2. Енкодер KY-040 (для меню)

```
KY-040:
├── CLK (A)  → Arduino Pin 2 (INT0)
├── DT (B)   → Arduino Pin 3 (INT1)
├── SW (BTN) → Arduino Pin 4
├── +        → Arduino 5V
└── GND      → Arduino GND
```

**Примітка:** KY-040 має вбудовані підтягуючі резистори, але Arduino використовує INPUT_PULLUP

---

### 3. Абсолютний енкодер P3022-CW360

```
P3022-CW360:
├── Вихід (0-5V) → Arduino A0 (аналоговий вхід)
├── VCC          → 5V (за специфікацією енкодера)
└── GND          → Arduino GND
```

**Примітка:** 
- Вихідна напруга: 0-5V (0° = 0V, 360° = 5V)
- Потрібне зовнішнє живлення згідно специфікації

---

### 4. Тумблер перемикання напрямку (CW/CCW)

```
Тумблер (SPST - однополюсний однопозиційний):
├── Вивід 1 → Arduino Pin 5
└── Вивід 2 → Arduino GND
```

**Примітка:**
- Використовується INPUT_PULLUP
- LOW (замкнено) = CW (за годинниковою стрілкою)
- HIGH (розімкнено) = CCW (проти годинникової стрілки)

---

### 5. Кнопка старт-стоп

```
Кнопка (NO - нормально розімкнена):
├── Вивід 1 → Arduino Pin 22
└── Вивід 2 → Arduino GND
```

**Примітка:** Використовується INPUT_PULLUP

---

### 6. Світлодіод індикації

```
Світлодіод:
├── Анод (+) → Arduino Pin 23 (через резистор 220Ω)
└── Катод (-) → Arduino GND
```

**Схема підключення:**
```
Arduino Pin 23 → [Резистор 220Ω] → Світлодіод (+) → Світлодіод (-) → GND
```

**Примітка:**
- Світлодіод світиться = двигун працює (RUN)
- Світлодіод вимкнений = двигун зупинений (STOP)

---

### 7. Драйвер DM556D

**Якщо на драйвері є STEP+/STEP- та DIR+/DIR- (диференційні входи):**

```
DM556D:
├── STEP+ → Arduino Pin 6 (OUTPUT) ⚠️ ЦЕ СИГНАЛ, НЕ ЖИВЛЕННЯ!
├── STEP- → Arduino GND (земля) ← З'єднуємо до купи (GND)
├── DIR+  → Arduino Pin 7 (OUTPUT) ⚠️ ЦЕ СИГНАЛ, НЕ ЖИВЛЕННЯ!
├── DIR-  → Arduino GND (земля) ← З'єднуємо до купи (GND)
├── GND   → Arduino GND (ОБОВ'ЯЗКОВО - спільна земля!)
├── ENA   → (опціонально) - можна підключити до GND для постійного ввімкнення
├── VCC   → 5V (логічне живлення драйвера)
│
├── A+ → Кроковий двигун (фаза A+)
├── A- → Кроковий двигун (фаза A-)
├── B+ → Кроковий двигун (фаза B+)
└── B- → Кроковий двигун (фаза B-)
│
└── VM+ → Живлення двигуна (12-24V) ⚠️ ОКРЕМЕ ДЖЕРЕЛО!
└── VM- → GND живлення двигуна (з'єднати з GND Arduino)
```

**⚠️ ВАЖЛИВО:**
- **STEP+ та DIR+** - це **цифрові сигнали** (0V/5V), НЕ живлення!
- **STEP+** підключається до **цифрового піна 6** (OUTPUT)
- **DIR+** підключається до **цифрового піна 7** (OUTPUT)
- **STEP- та DIR-** - це негативні входи, завжди підключаються до **GND** (земля)
- **STEP-, DIR-, GND, VM-** - все з'єднується до купи (GND)!
- **GND** має бути **спільним** між Arduino та DM556D (обов'язково!)
- **VCC** - логічне живлення драйвера (5V)
- **VM+/VM-** - живлення двигуна (12-24V), окреме джерело!
- **НЕ підключайте VM+ до Arduino!** Це може пошкодити плату!

---

### 8. Кроковий двигун

```
Кроковий двигун (4-провідний):
├── Фаза A+ → DM556D A+
├── Фаза A- → DM556D A-
├── Фаза B+ → DM556D B+
└── Фаза B- → DM556D B-
```

**Примітка:** 
- Перевірте документацію двигуна для правильного підключення фаз
- Налаштування мікростепів на DM556D: 16 (за config.h)

---

## Схема живлення

### Рекомендована схема

```
┌─────────────────┐
│ Блок живлення   │
│ 12-24V DC       │
└────────┬────────┘
         │
         ├──→ DM556D VM+ (живлення двигуна)
         │
         └──→ GND (загальна земля)
              │
              ├──→ DM556D VM-
              ├──→ Arduino GND
              └──→ Всі компоненти GND

┌─────────────────┐
│ Блок живлення   │
│ 5V (USB/адаптер)│
└────────┬────────┘
         │
         ├──→ Arduino 5V
         │    ├──→ LCD 2004 I2C VCC
         │    ├──→ KY-040 +
         │    └──→ DM556D VCC (логічне)
         │
         └──→ P3022-CW360 VCC (якщо потрібно)
```

---

## Таблиця підсумкова

| Компонент | Пін Arduino | Тип піна | Примітки |
|-----------|-------------|----------|----------|
| LCD 2004 I2C SDA | 20 | I2C | Стандартний SDA |
| LCD 2004 I2C SCL | 21 | I2C | Стандартний SCL |
| KY-040 CLK | 2 | Digital (INT0) | Переривання |
| KY-040 DT | 3 | Digital (INT1) | Переривання |
| KY-040 SW | 4 | Digital (INPUT_PULLUP) | Кнопка енкодера |
| Тумблер | 5 | Digital (INPUT_PULLUP) | CW/CCW |
| DM556D STEP | 6 | Digital (OUTPUT) | Імпульси кроків |
| DM556D DIR | 7 | Digital (OUTPUT) | Напрямок |
| Кнопка старт-стоп | 22 | Digital (INPUT_PULLUP) | Запуск/зупинка |
| Світлодіод | 23 | Digital (OUTPUT) | Індикація |
| P3022-CW360 | A0 | Analog (INPUT) | Абсолютний енкодер |

---

## Налаштування в config.h

Переконайтеся, що в `config.h` встановлено:

```cpp
#define LCD_TYPE 2        // LCD2004 (20x4)
#define LCD_MODE 1        // I2C режим
#define LCD_I2C_ADDRESS 0x27  // Адреса I2C (може бути 0x3F)
```

---

## Перевірка підключення

### Перед включенням перевірте:

1. ✅ Всі GND з'єднані разом
2. ✅ Живлення 5V підключене правильно
3. ✅ Живлення двигуна (12-24V) підключене до DM556D
4. ✅ I2C адреса LCD правильна (використайте I2C сканер)
5. ✅ Резистор 220Ω для світлодіода
6. ✅ Перемикач та кнопки підключені до GND (INPUT_PULLUP)
7. ✅ Енкодер KY-040 підключений правильно (CLK, DT, SW)
8. ✅ Абсолютний енкодер підключений до A0

---

## Рекомендації

1. **Захист:** Додайте діоди для захисту від зворотної напруги
2. **Фільтрація:** Додайте конденсатори для фільтрації живлення
3. **Екранування:** Використовуйте екрановані кабелі для аналогового енкодера
4. **Охолодження:** DM556D може потребувати радіатора при високих струмах
5. **Земля:** Переконайтеся в надійному з'єднанні всіх GND

---

## Діагностика

### Якщо LCD не працює:
- Перевірте адресу I2C (використайте I2C сканер)
- Перевірте підключення SDA/SCL
- Перевірте живлення 5V

### Якщо енкодер не працює:
- Перевірте підключення CLK та DT
- Перевірте, що використовуються піни 2 та 3 (INT0, INT1)

### Якщо двигун не рухається:
- Перевірте живлення VM+/VM- на DM556D
- Перевірте підключення STEP та DIR
- Перевірте налаштування мікростепів на DM556D
- Перевірте, що кнопка старт-стоп активована

### Якщо абсолютний енкодер не працює:
- Перевірте підключення до A0
- Перевірте живлення енкодера
- Перевірте діапазон напруги (0-5V)

---

## Додаткові ресурси

- **Arduino Mega 2560:** https://www.arduino.cc/en/Main/ArduinoBoardMega2560
- **LCD 2004 I2C:** Залежить від виробника модуля
- **KY-040:** Стандартний інкрементальний енкодер
- **DM556D:** Драйвер крокового двигуна з мікростепами
- **P3022-CW360:** Абсолютний енкодер 360°
